# Social Auto Upload äº‘æœåŠ¡å™¨éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 7+ / Debian 10+
- **å†…å­˜**: è‡³å°‘ 2GB RAM
- **å­˜å‚¨**: è‡³å°‘ 20GB å¯ç”¨ç©ºé—´
- **CPU**: 2æ ¸ä»¥ä¸Šæ¨è
- **ç½‘ç»œ**: å…¬ç½‘IPï¼Œå¼€æ”¾ç«¯å£ 80, 443, 5409, 5173

### 2. åŸŸåå‡†å¤‡ï¼ˆå¯é€‰ï¼‰
- å‡†å¤‡ä¸€ä¸ªåŸŸåå¹¶é…ç½® DNS è§£æåˆ°æœåŠ¡å™¨IP
- å¦‚æœæ²¡æœ‰åŸŸåï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨IPåœ°å€è®¿é—®

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥æœåŠ¡å™¨

```bash
# ä½¿ç”¨SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip
# æˆ–ä½¿ç”¨å¯†é’¥ç™»å½•
ssh -i your-key.pem ubuntu@your-server-ip
```

### ç¬¬äºŒæ­¥ï¼šæ›´æ–°ç³»ç»Ÿ

```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…åŸºç¡€ç¯å¢ƒ

#### å®‰è£… Python 3.9+
```bash
# Ubuntu/Debian
sudo apt install python3 python3-pip python3-venv -y

# CentOS/RHEL
sudo yum install python3 python3-pip -y
```

#### å®‰è£… Node.js å’Œ npm
```bash
# ä½¿ç”¨ NodeSource å®˜æ–¹æºå®‰è£…æœ€æ–° LTS ç‰ˆæœ¬
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# æˆ–è€…ä½¿ç”¨ nvm å®‰è£…
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install --lts
nvm use --lts
```

#### å®‰è£…å…¶ä»–å¿…è¦å·¥å…·
```bash
# Ubuntu/Debian
sudo apt install git nginx supervisor ufw sqlite3 -y

# CentOS/RHEL
sudo yum install git nginx supervisor firewalld sqlite -y
```

### ç¬¬å››æ­¥ï¼šå…‹éš†é¡¹ç›®ä»£ç 

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www
cd /var/www

# å…‹éš†é¡¹ç›®ï¼ˆæ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼‰
sudo git clone https://github.com/your-username/social-auto-upload.git
cd social-auto-upload

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R $USER:$USER /var/www/social-auto-upload
chmod +x *.sh
```

### ç¬¬äº”æ­¥ï¼šé…ç½®é¡¹ç›®ç¯å¢ƒ

#### åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt
```

#### åˆ›å»ºé…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp conf.example.py conf.py

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano conf.py
```

ä¿®æ”¹ `conf.py` æ–‡ä»¶å†…å®¹ï¼š
```python
from pathlib import Path

BASE_DIR = Path(__file__).parent.resolve()
XHS_SERVER = "http://127.0.0.1:11901"
# è®¾ç½®Chromeè·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
LOCAL_CHROME_PATH = "/usr/bin/google-chrome"  # Ubuntuä¸­Chromeçš„è·¯å¾„
```

#### åˆå§‹åŒ–æ•°æ®åº“
```bash
# åˆ›å»ºæ•°æ®åº“
cd db
python3 createTable.py
cd ..
```

#### å®‰è£…å‰ç«¯ä¾èµ–
```bash
cd sau_frontend
npm install
npm run build
cd ..
```

### ç¬¬å…­æ­¥ï¼šé…ç½®ç³»ç»ŸæœåŠ¡

#### åˆ›å»ºåç«¯æœåŠ¡é…ç½®
```bash
sudo nano /etc/supervisor/conf.d/sau-backend.conf
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```ini
[program:sau-backend]
command=/var/www/social-auto-upload/venv/bin/python sau_backend.py
directory=/var/www/social-auto-upload
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/sau-backend.log
environment=PATH="/var/www/social-auto-upload/venv/bin"
```

#### é‡å¯ Supervisor
```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start sau-backend
```

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® Nginx

åˆ›å»º Nginx é…ç½®æ–‡ä»¶ï¼š
```bash
sudo nano /etc/nginx/sites-available/social-auto-upload
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IP

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/social-auto-upload/sau_frontend/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # API ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://127.0.0.1:5409/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # SSE ç‰¹æ®Šé…ç½®
        proxy_buffering off;
        proxy_cache off;
        proxy_set_header Connection '';
        proxy_http_version 1.1;
        chunked_transfer_encoding off;
    }

    # æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
    location /upload {
        proxy_pass http://127.0.0.1:5409/upload;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        client_max_body_size 200M;
    }

    # é™æ€èµ„æº
    location /assets/ {
        root /var/www/social-auto-upload/sau_frontend/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨ç«™ç‚¹é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/social-auto-upload /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# Ubuntu UFW
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS Firewalld
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### ç¬¬ä¹æ­¥ï¼šSSL è¯ä¹¦é…ç½®ï¼ˆHTTPSï¼‰

#### ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ
0 12 * * * /usr/bin/certbot renew --quiet
```

#### æ‰‹åŠ¨é…ç½®SSLï¼ˆå¦‚æœæœ‰è‡ªå·±çš„è¯ä¹¦ï¼‰
```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;
    ssl_session_timeout 1d;
    ssl_session_cache shared:MozTLS:10m;
    ssl_session_tickets off;

    # å…¶ä»–é…ç½®åŒä¸Š...
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

## ğŸ”§ é«˜çº§é…ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
sudo nano /var/www/social-auto-upload/.env
```

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=sqlite:///db/database.db

# æœåŠ¡é…ç½®
FLASK_HOST=0.0.0.0
FLASK_PORT=5409
FLASK_DEBUG=false

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/var/log/sau-backend.log

# æ–‡ä»¶ä¸Šä¼ é…ç½®
MAX_CONTENT_LENGTH=200
UPLOAD_FOLDER=/var/www/social-auto-upload/videoFile
```

### 2. æ—¥å¿—è½®è½¬é…ç½®

```bash
sudo nano /etc/logrotate.d/social-auto-upload
```

```bash
/var/log/sau-backend.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    postrotate
        supervisorctl restart sau-backend
    endscript
}
```

### 3. æ•°æ®åº“å¤‡ä»½è„šæœ¬

```bash
sudo nano /var/www/social-auto-upload/backup_db.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/var/backups/social-auto-upload"
DATE=$(date +%Y%m%d_%H%M%S)
DB_FILE="/var/www/social-auto-upload/db/database.db"

mkdir -p $BACKUP_DIR
cp $DB_FILE "$BACKUP_DIR/database_$DATE.db"

# åªä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "database_*.db" -mtime +30 -delete
```

```bash
sudo chmod +x /var/www/social-auto-upload/backup_db.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /var/www/social-auto-upload/backup_db.sh
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. ç³»ç»Ÿç›‘æ§è„šæœ¬

```bash
sudo nano /var/www/social-auto-upload/monitor.sh
```

```bash
#!/bin/bash

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_service() {
    service_name=$1
    if systemctl is-active --quiet $service_name; then
        echo "âœ… $service_name is running"
    else
        echo "âŒ $service_name is not running"
        systemctl restart $service_name
    fi
}

# æ£€æŸ¥ç«¯å£
check_port() {
    port=$1
    service_name=$2
    if netstat -tlnp | grep ":$port " > /dev/null; then
        echo "âœ… Port $port ($service_name) is open"
    else
        echo "âŒ Port $port ($service_name) is not accessible"
    fi
}

echo "=== System Monitor ==="
date
echo ""

# æ£€æŸ¥ç³»ç»Ÿèµ„æº
echo "CPU Usage:"
top -bn1 | grep load | awk '{printf "%.2f%%\n\n", $(NF-2)}'

echo "Memory Usage:"
free -h

echo "Disk Usage:"
df -h /

echo ""
echo "=== Service Status ==="
check_service nginx
check_service supervisor

echo ""
echo "=== Port Status ==="
check_port 80 "HTTP"
check_port 443 "HTTPS"
check_port 5409 "Backend API"

echo ""
echo "=== Process Status ==="
ps aux | grep -E "(sau_backend|nginx)" | grep -v grep
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### Nginx ä¼˜åŒ–
```bash
sudo nano /etc/nginx/nginx.conf
```

```nginx
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}

http {
    # åŸºç¡€é…ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml;
        
    # ç¼“å­˜é…ç½®
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    
    include /etc/nginx/sites-enabled/*;
}
```

#### Python åç«¯ä¼˜åŒ–
å¯ä»¥è€ƒè™‘ä½¿ç”¨ Gunicorn ä»£æ›¿ç›´æ¥è¿è¡Œ Flaskï¼š

```bash
pip install gunicorn

# åˆ›å»º Gunicorn é…ç½®
nano gunicorn.conf.py
```

```python
bind = "127.0.0.1:5409"
workers = 2
worker_class = "sync"
worker_connections = 1000
timeout = 30
keepalive = 60
max_requests = 1000
max_requests_jitter = 100
preload_app = True
```

æ›´æ–° Supervisor é…ç½®ï¼š
```ini
[program:sau-backend]
command=/var/www/social-auto-upload/venv/bin/gunicorn -c gunicorn.conf.py sau_backend:app
directory=/var/www/social-auto-upload
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/sau-backend.log
environment=PATH="/var/www/social-auto-upload/venv/bin"
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

1. **åç«¯æœåŠ¡æ— æ³•å¯åŠ¨**
```bash
# æ£€æŸ¥æ—¥å¿—
sudo tail -f /var/log/sau-backend.log
sudo supervisorctl status
sudo supervisorctl restart sau-backend
```

2. **å‰ç«¯é¡µé¢æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx
sudo nginx -t
sudo systemctl reload nginx
```

3. **æ•°æ®åº“è¿æ¥é—®é¢˜**
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la /var/www/social-auto-upload/db/
sudo chown -R www-data:www-data /var/www/social-auto-upload/db/
```

4. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
sudo mkdir -p /var/www/social-auto-upload/videoFile
sudo chown -R www-data:www-data /var/www/social-auto-upload/videoFile
sudo chmod 755 /var/www/social-auto-upload/videoFile
```

## ğŸ“ ç»´æŠ¤å‘½ä»¤

### å¸¸ç”¨ç»´æŠ¤å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo supervisorctl status
sudo systemctl status nginx

# é‡å¯æœåŠ¡
sudo supervisorctl restart sau-backend
sudo systemctl reload nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/sau-backend.log
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# æ›´æ–°ä»£ç 
cd /var/www/social-auto-upload
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
cd sau_frontend
npm install
npm run build
cd ..
sudo supervisorctl restart sau-backend
sudo systemctl reload nginx

# æ¸…ç†æ—¥å¿—
sudo logrotate -f /etc/logrotate.d/social-auto-upload
```

## âœ… éƒ¨ç½²éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **è®¿é—®æµ‹è¯•**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://your-domain.com` æˆ– `http://your-server-ip`
   - ç¡®è®¤å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½

2. **API æµ‹è¯•**
   - è®¿é—® `http://your-domain.com/api/` ç¡®è®¤åç«¯APIå“åº”

3. **åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
   - æµ‹è¯•è´¦å·ç®¡ç†åŠŸèƒ½
   - æµ‹è¯•è§†é¢‘å‘å¸ƒåŠŸèƒ½

4. **æ€§èƒ½æµ‹è¯•**
   - ä½¿ç”¨ `htop` æˆ– `top` ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
   - æ£€æŸ¥æœåŠ¡å“åº”æ—¶é—´

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼ä½ å·²ç»æˆåŠŸå°† Social Auto Upload é¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šã€‚

**è®¿é—®åœ°å€**:
- å‰ç«¯ç•Œé¢: `https://your-domain.com`
- API æ¥å£: `https://your-domain.com/api/`

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. è®¾ç½®å®šæœŸå¤‡ä»½ç­–ç•¥
2. é…ç½®ç›‘æ§å‘Šè­¦
3. ä¼˜åŒ–æœåŠ¡å™¨æ€§èƒ½
4. å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚ 